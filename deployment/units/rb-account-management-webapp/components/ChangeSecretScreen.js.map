{"version":3,"sources":["../../../../units/rb-account-management-webapp/components/ChangeSecretScreen.jsx"],"names":["styles","card","minWidth","ChangeSecretScreen","React","Component","constructor","props","context","_handle_onClick_Change","User_CurrentSecret","User_NewSecret","state","setState","currentOperation","loc","window","location","host","protocol","hostname","port","response","fetch","method","credentials","headers","body","JSON","stringify","responseData","json","success","executionStatus","error","err","message","_handle_onClick_CancelChange","_handle_onClick_TryAgain","_handle_onClick_Continue","replace","_handle_onChange_Identifier","event","target","value","_handle_onUpdateSecret","secret","renderChanging","classes","renderSuccess","renderFailure","renderPrompt","createDisabled","length","render"],"mappings":";;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,kF;;AAEA;;AAEA,MAAMA,MAAM,GAAG;AACbC,EAAAA,IAAI,EAAE;AACJC,IAAAA,QAAQ,EAAE,GADN;;;;AAKR;AANe,CAAf;AAQA,MAAMC,kBAAN,SAAiCC,eAAMC;;;;;;;;;;AAUrC;AACAC,EAAAA,WAAW,CAAEC,KAAF,EAAiBC,OAAjB,EAAmC;AAC5C,UAAOD,KAAP,EAAcC,OAAd,EAD4C;;;;;;;;;;AAW9CC,IAAAA,sBAX8C,GAWrB,YAAW;AAClC,YAAM,EAAEC,kBAAF,EAAsBC,cAAtB,KAAyC,KAAKC,KAApD;;AAEA,WAAKC,QAAL,CAAc;AACZC,QAAAA,gBAAgB,EAAE,UADN,EAAd;;;AAIA,UAAI;AACF,cAAMC,GAAG,GAAGC,MAAM,CAACC,QAAnB;AACA,cAAMC,IAAI,GAAGH,GAAG,CAACI,QAAJ,GAAe,IAAf,GAAsBJ,GAAG,CAACK,QAA1B,GAAqC,GAArC,GAA2CL,GAAG,CAACM,IAA5D;;AAEA,cAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAEL,IAAI,GAAG,qBAAT,EAAgC;AAC1DM,UAAAA,MAAM,EAAE,MADkD;AAE1DC,UAAAA,WAAW,EAAE,aAF6C;AAG1DC,UAAAA,OAAO,EAAE;AACP,4BAAgB,kBADT,EAHiD;;AAM1DC,UAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBnB,YAAAA,kBADmB;AAEnBC,YAAAA,cAFmB,EAAf,CANoD,EAAhC,CAA5B;;;;AAYA,cAAMmB,YAAY,GAAG,MAAMR,QAAQ,CAACS,IAAT,EAA3B;;AAEA,YAAKD,YAAY,CAACE,OAAlB,EAA4B;AAC1B;AACA,eAAKnB,QAAL,CAAc,EAAEC,gBAAgB,EAAE,SAApB,EAAd;AACD,SAHD,MAGO;AACL;AACA,eAAKD,QAAL,CAAc;AACZC,YAAAA,gBAAgB,EAAE,SADN;AAEZmB,YAAAA,eAAe,EAAEH,YAAY,CAACI,KAFlB,EAAd;;AAID;AACF,OA5BD,CA4BE,OAAQC,GAAR,EAAc;AACd;AACA;AACA,aAAKtB,QAAL,CAAc;AACZC,UAAAA,gBAAgB,EAAE,SADN;AAEZmB,UAAAA,eAAe;AACb;AACAE,UAAAA,GAAG,CAACC,OAJM,EAAd;;AAMD;AACF,KAxD6C;;AA0D9CC,IAAAA,4BA1D8C,GA0Df,MAAM;AACnC,WAAKxB,QAAL,CAAc;AACZC,QAAAA,gBAAgB,EAAE,SADN;AAEZmB,QAAAA,eAAe,EAAE,iCAFL,EAAd;;AAID,KA/D6C;;AAiE9CK,IAAAA,wBAjE8C,GAiEnB,MAAM;AAC/B,WAAKzB,QAAL,CAAc;AACZH,QAAAA,kBAAkB,EAAE,EADR;AAEZI,QAAAA,gBAAgB,EAAE,QAFN;AAGZmB,QAAAA,eAAe,EAAE,EAHL,EAAd;;AAKD,KAvE6C;;AAyE9CM,IAAAA,wBAzE8C,GAyEnB,MAAM;AAC/BvB,MAAAA,MAAM,CAACC,QAAP,CAAgBuB,OAAhB,CAAyB,eAAzB;AACD,KA3E6C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmI9CC,IAAAA,2BAnI8C,GAmIhBC,KAAK,IAAI;AACrC,YAAMhC,kBAAkB,GAAGgC,KAAK,CAACC,MAAN,CAAaC,KAAxC;;AAEA,WAAK/B,QAAL,CAAc,EAAEH,kBAAF,EAAd;AACD,KAvI6C;;AAyI9CmC,IAAAA,sBAzI8C,GAyIrBC,MAAM,IAAI;AACjC,WAAKjC,QAAL,CAAc,EAAEF,cAAc,EAAEmC,MAAlB,EAAd;AACD,KA3I6C,CAG5C,KAAKlC,KAAL,GAAa,EACXE,gBAAgB,EAAE,QADP,EAEXmB,eAAe,EAAE,EAFN,EAGXvB,kBAAkB,EAAE,EAHT,EAIXC,cAAc,EAAE,EAJL,EAAb,CAMD,CAoEDoC,cAAc,GAAG,CACf,MAAM,EAAEC,OAAF,KAAc,KAAKzC,KAAzB,CAEA,OACE,6BAAC,aAAD,IAAM,SAAS,EAAEyC,OAAO,CAAC/C,IAAzB,IACE,6BAAC,mBAAD,IAAY,KAAK,EAAC,mBAAlB,GADF,EAEE,6BAAC,oBAAD,QACE,6BAAC,mBAAD,IAAY,SAAS,EAAC,GAAtB,6BADF,EAEE,wCAFF,EAGE,wCAHF,EAIE,6BAAC,uBAAD,IAAgB,IAAI,EAAC,OAArB,GAJF,CAFF,EAQE,6BAAC,oBAAD,QACE,6BAAC,eAAD,IAAQ,OAAO,EAAE,KAAKoC,4BAAtB,aADF,CARF,CADF,CAcD,CAEDY,aAAa,GAAG,CACd,MAAM,EAAED,OAAF,KAAc,KAAKzC,KAAzB,CAEA,OACE,6BAAC,aAAD,IAAM,SAAS,EAAEyC,OAAO,CAAC/C,IAAzB,IACE,6BAAC,mBAAD,IAAY,KAAK,EAAC,mBAAlB,GADF,EAEE,6BAAC,oBAAD,QACE,6BAAC,mBAAD,IAAY,SAAS,EAAC,GAAtB,qCADF,CAFF,EAKE,6BAAC,oBAAD,QACE,6BAAC,eAAD,IAAQ,OAAO,EAAE,KAAKsC,wBAAtB,eADF,CALF,CADF,CAWD,CAEDW,aAAa,GAAG,CACd,MAAM,EAAEF,OAAF,KAAc,KAAKzC,KAAzB,CACA,MAAM,EAAE0B,eAAF,KAAsB,KAAKrB,KAAjC,CAEA,OACE,6BAAC,aAAD,IAAM,SAAS,EAAEoC,OAAO,CAAC/C,IAAzB,IACE,6BAAC,mBAAD,IAAY,KAAK,EAAC,mBAAlB,GADF,EAEE,6BAAC,oBAAD,QACE,6BAAC,mBAAD,IAAY,SAAS,EAAC,GAAtB,yCACoCgC,eADpC,MADF,CAFF,EAOE,6BAAC,oBAAD,QACE,6BAAC,eAAD,IAAQ,OAAO,EAAE,KAAKK,wBAAtB,gBADF,CAPF,CADF,CAaD;;AAYDa,EAAAA,YAAY,GAAG;AACb,UAAM,EAAEH,OAAF,KAAc,KAAKzC,KAAzB;AACA,UAAM,EAAEG,kBAAF,EAAsBC,cAAtB,KAAyC,KAAKC,KAApD;;AAEA;AACA,UAAMwC,cAAc;AAClB1C,IAAAA,kBAAkB,CAAC2C,MAAnB,GAA4B,CAA5B,IAAiC1C,cAAc,KAAK,EADtD;;AAGA;AACE,mCAAC,aAAD,IAAM,SAAS,EAAEqC,OAAO,CAAC/C,IAAzB;AACE,mCAAC,mBAAD,IAAY,KAAK,EAAC,iBAAlB,GADF;AAEE,mCAAC,oBAAD;AACE,mCAAC,kBAAD;AACE,QAAA,YAAY,EAAC,UADf;AAEE,QAAA,SAAS,EAAE,IAFb;AAGE,QAAA,KAAK,EAAC,wBAHR;AAIE,QAAA,MAAM,EAAC,QAJT;AAKE,QAAA,IAAI,EAAC,UALP;AAME,QAAA,KAAK,EAAES,kBANT;AAOE,QAAA,OAAO,EAAC,UAPV;AAQE,QAAA,QAAQ,EAAE,KAAK+B,2BARjB,GADF;;;AAYE,8CAZF;AAaE,8CAbF;;AAeE,mCAAC,2BAAD,IAAoB,cAAc,EAAE,KAAKI,sBAAzC,GAfF,CAFF;;AAmBE,mCAAC,oBAAD;AACE,mCAAC,eAAD;AACE,QAAA,QAAQ,EAAEO,cADZ;AAEE,QAAA,OAAO,EAAE,KAAK3C,sBAFhB,aADF,CAnBF,CADF;;;;;;;AA8BD;;AAED6C,EAAAA,MAAM,GAAG;AACP,UAAM,EAAExC,gBAAF,KAAuB,KAAKF,KAAlC;;AAEA;AACE,mCAAC,8BAAD;AACGE,MAAAA,gBAAgB,KAAK,QAArB,IAAiC,KAAKqC,YAAL,EADpC;AAEGrC,MAAAA,gBAAgB,KAAK,UAArB,IAAmC,KAAKiC,cAAL,EAFtC;AAGGjC,MAAAA,gBAAgB,KAAK,SAArB,IAAkC,KAAKmC,aAAL,EAHrC;AAIGnC,MAAAA,gBAAgB,KAAK,SAArB,IAAkC,KAAKoC,aAAL,EAJrC,CADF;;;AAQD,GAjMD,C;;;AAoMa,wBAAYlD,MAAZ,EAAsBG,kBAAtB,C","sourcesContent":["// @flow\n\nimport Button from '@material-ui/core/Button'\n\nimport Card from '@material-ui/core/Card'\n\nimport CardActions from '@material-ui/core/CardActions'\n\nimport CardContent from '@material-ui/core/CardContent'\n\nimport CardHeader from '@material-ui/core/CardHeader'\n\nimport LinearProgress from '@material-ui/core/LinearProgress'\n\nimport { withStyles } from '@material-ui/core/styles'\n\nimport TextField from '@material-ui/core/TextField'\n\nimport Typography from '@material-ui/core/Typography'\n\nimport React from 'react'\n\nimport ResponsiveContentArea from '../../rb-appbase-webapp/components/ResponsiveContentArea'\n\nimport NewUserSecretInput from './NewUserSecretInput'\n\n//\n\nconst styles = {\n  card: {\n    minWidth: 320,\n  },\n}\n\n//\n\nclass ChangeSecretScreen extends React.Component<\n  {\n    classes: Object,\n  },\n  {\n    currentOperation: 'prompt' | 'changing' | 'success' | 'failure',\n    executionStatus: string,\n    User_CurrentSecret: string,\n    User_NewSecret: string,\n  }\n> {\n  constructor( props: Object, context: Object ) {\n    super( props, context )\n\n    this.state = {\n      currentOperation: 'prompt',\n      executionStatus: '',\n      User_CurrentSecret: '',\n      User_NewSecret: '',\n    }\n  }\n\n  _handle_onClick_Change = async() => {\n    const { User_CurrentSecret, User_NewSecret } = this.state\n\n    this.setState({\n      currentOperation: 'changing',\n    })\n\n    try {\n      const loc = window.location\n      const host = loc.protocol + '//' + loc.hostname + ':' + loc.port\n\n      const response = await fetch( host + '/auth/change-secret', {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          User_CurrentSecret,\n          User_NewSecret,\n        }),\n      })\n\n      const responseData = await response.json()\n\n      if ( responseData.success ) {\n        // In case of success, notify user\n        this.setState({ currentOperation: 'success' })\n      } else {\n        // In case of error, tell user what the error is\n        this.setState({\n          currentOperation: 'failure',\n          executionStatus: responseData.error,\n        })\n      }\n    } catch ( err ) {\n      // In case response could not be received properly, tell the user\n      // In case of error, tell user what the error is\n      this.setState({\n        currentOperation: 'failure',\n        executionStatus:\n          'Did not receive proper response from server. Please try again. Message:' +\n          err.message,\n      })\n    }\n  }\n\n  _handle_onClick_CancelChange = () => {\n    this.setState({\n      currentOperation: 'failure',\n      executionStatus: 'User creation has been canceled',\n    })\n  }\n\n  _handle_onClick_TryAgain = () => {\n    this.setState({\n      User_CurrentSecret: '',\n      currentOperation: 'prompt',\n      executionStatus: '',\n    })\n  }\n\n  _handle_onClick_Continue = () => {\n    window.location.replace( '/user/profile' )\n  }\n\n  renderChanging() {\n    const { classes } = this.props\n\n    return (\n      <Card className={classes.card}>\n        <CardHeader title=\"Changing password\" />\n        <CardContent>\n          <Typography component=\"p\">Updating, please wait.</Typography>\n          <br />\n          <br />\n          <LinearProgress mode=\"query\" />\n        </CardContent>\n        <CardActions>\n          <Button onClick={this._handle_onClick_CancelChange}>Cancel</Button>\n        </CardActions>\n      </Card>\n    )\n  }\n\n  renderSuccess() {\n    const { classes } = this.props\n\n    return (\n      <Card className={classes.card}>\n        <CardHeader title=\"Changing password\" />\n        <CardContent>\n          <Typography component=\"p\">Password successfully changed.</Typography>\n        </CardContent>\n        <CardActions>\n          <Button onClick={this._handle_onClick_Continue}>Continue</Button>\n        </CardActions>\n      </Card>\n    )\n  }\n\n  renderFailure() {\n    const { classes } = this.props\n    const { executionStatus } = this.state\n\n    return (\n      <Card className={classes.card}>\n        <CardHeader title=\"Changing password\" />\n        <CardContent>\n          <Typography component=\"p\">\n            Changing password failed because {executionStatus}.\n          </Typography>\n        </CardContent>\n        <CardActions>\n          <Button onClick={this._handle_onClick_TryAgain}>Try Again</Button>\n        </CardActions>\n      </Card>\n    )\n  }\n\n  _handle_onChange_Identifier = event => {\n    const User_CurrentSecret = event.target.value\n\n    this.setState({ User_CurrentSecret })\n  }\n\n  _handle_onUpdateSecret = secret => {\n    this.setState({ User_NewSecret: secret })\n  }\n\n  renderPrompt() {\n    const { classes } = this.props\n    const { User_CurrentSecret, User_NewSecret } = this.state\n\n    // User account identifier must be valid and secret must be present\n    const createDisabled =\n      User_CurrentSecret.length < 5 || User_NewSecret === ''\n\n    return (\n      <Card className={classes.card}>\n        <CardHeader title=\"Change Password\" />\n        <CardContent>\n          <TextField\n            autoComplete=\"password\"\n            fullWidth={true}\n            label=\"Current (old) password\"\n            margin=\"normal\"\n            type=\"password\"\n            value={User_CurrentSecret}\n            variant=\"outlined\"\n            onChange={this._handle_onChange_Identifier}\n          />\n\n          <br />\n          <br />\n\n          <NewUserSecretInput onUpdateSecret={this._handle_onUpdateSecret} />\n        </CardContent>\n        <CardActions>\n          <Button\n            disabled={createDisabled}\n            onClick={this._handle_onClick_Change}\n          >\n            Change\n          </Button>\n        </CardActions>\n      </Card>\n    )\n  }\n\n  render() {\n    const { currentOperation } = this.state\n\n    return (\n      <ResponsiveContentArea>\n        {currentOperation === 'prompt' && this.renderPrompt()}\n        {currentOperation === 'changing' && this.renderChanging()}\n        {currentOperation === 'success' && this.renderSuccess()}\n        {currentOperation === 'failure' && this.renderFailure()}\n      </ResponsiveContentArea>\n    )\n  }\n}\n\nexport default withStyles( styles )( ChangeSecretScreen )\n"],"file":"ChangeSecretScreen.js"}
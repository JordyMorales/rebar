{"version":3,"sources":["../../../../units/rb-account-management-webapp/components/NewUserSecretInput.jsx"],"names":["scoreSecret","secret","uniqueLettersAwardUntilRepetitions","variationAwardCoefficient","score","letters","i","length","variations","digits","test","lower","upper","nonWords","variationCount","check","styles","strengthColorPrimary","backgroundColor","strengthBarColorPrimary_poor","strengthBarColorPrimary_fair","strengthBarColorPrimary_good","NewUserSecretInput","React","Component","constructor","props","context","_handle_onChange_Secret","event","userSecret","target","value","setState","updateErrorAndValue","state","userSecretConfirm","_handle_onChange_SecretConfirm","userSecretPrompt","userSecretStrength","userSecretQuality","bPasswordsMatch","determinedValue","userSecretStrengthGood","userSecretStrengthFair","onUpdateSecret","render","classes","colorPrimary","barColorPrimary"],"mappings":"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","sourcesContent":["// @flow\n\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport { withStyles } from '@material-ui/core/styles'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport React from 'react'\nimport {\n  uniqueLettersAwardUntilRepetitions,\n  userSecretStrengthGood,\n  userSecretStrengthFair,\n  variationAwardCoefficient,\n} from '../../_configuration/rb-account-management-webapp/userIDAndSecret'\n\n//\n\nfunction scoreSecret(\n  secret: string,\n  uniqueLettersAwardUntilRepetitions: number,\n  variationAwardCoefficient: number,\n) {\n  let score = 0\n  if (!secret) return 0\n\n  // Award every unique letter until 5 repetitions\n  let letters: Object = {}\n  for (let i = 0; i < secret.length; i++) {\n    letters[secret[i]] = (letters[secret[i]] || 0) + 1\n    score += uniqueLettersAwardUntilRepetitions / letters[secret[i]]\n  }\n\n  // Bonus points for mixing it up\n  let variations = {\n    digits: /\\d/.test(secret),\n    lower: /[a-z]/.test(secret),\n    upper: /[A-Z]/.test(secret),\n    nonWords: /\\W/.test(secret),\n  }\n\n  let variationCount = 0\n  for (let check in variations)\n    variationCount += variations[check] === true ? 1 : 0\n\n  score += (variationCount - 1) * variationAwardCoefficient\n\n  return score\n}\n\n//\n\nconst styles = {\n  strengthColorPrimary: {\n    backgroundColor: '#a0a0a0',\n  },\n\n  strengthBarColorPrimary_poor: {\n    backgroundColor: '#a00000',\n  },\n  strengthBarColorPrimary_fair: {\n    backgroundColor: '#0000a0',\n  },\n  strengthBarColorPrimary_good: {\n    backgroundColor: '#00a000',\n  },\n}\n\n//\n\nclass NewUserSecretInput extends React.Component<\n  { classes: typeof styles, onUpdateSecret: string => void },\n  {\n    userSecret: string,\n    userSecretConfirm: string,\n    userSecretPrompt: string,\n    userSecretStrength: number,\n    userSecretQuality: 'poor' | 'fair' | 'good',\n  },\n> {\n  constructor(props: any, context: any) {\n    super(props, context)\n\n    this.state = {\n      userSecret: '',\n      userSecretConfirm: '',\n      userSecretPrompt: '',\n      userSecretStrength: 0,\n      userSecretQuality: 'poor',\n    }\n  }\n\n  updateErrorAndValue(userSecret: string, userSecretConfirm: string) {\n    // Collect errors\n    let userSecretPrompt = ''\n\n    // If secrets match ....\n    const bPasswordsMatch = userSecret === userSecretConfirm\n    let determinedValue = bPasswordsMatch ? userSecret : ''\n    if (!bPasswordsMatch) {\n      userSecretPrompt = 'Passwords do not match'\n    }\n\n    // Determine secret complexity\n    const userSecretStrength = scoreSecret(\n      userSecret,\n      uniqueLettersAwardUntilRepetitions,\n      variationAwardCoefficient,\n    )\n\n    // Determine secret quality\n    const userSecretQuality =\n      userSecretStrength >= userSecretStrengthGood\n        ? 'good'\n        : userSecretStrength >= userSecretStrengthFair ? 'fair' : 'poor'\n\n    if (userSecretPrompt === '') {\n      userSecretPrompt = 'Password strength: ' + userSecretQuality\n    }\n\n    // If quality is not gooe enough, clear\n    if (userSecretQuality === 'poor') {\n      determinedValue = ''\n    }\n\n    this.props.onUpdateSecret(determinedValue)\n\n    this.setState({ userSecretPrompt, userSecretQuality, userSecretStrength })\n  }\n\n  _handle_onChange_Secret = (event) => {\n    const userSecret = event.target.value\n\n    this.setState({ userSecret })\n\n    this.updateErrorAndValue(userSecret, this.state.userSecretConfirm)\n  }\n\n  _handle_onChange_SecretConfirm = (event) => {\n    const userSecretConfirm = event.target.value\n\n    this.setState({ userSecretConfirm })\n\n    this.updateErrorAndValue(this.state.userSecret, userSecretConfirm)\n  }\n\n  render() {\n    const { classes } = this.props\n    const {\n      userSecret,\n      userSecretConfirm,\n      userSecretPrompt,\n      userSecretQuality,\n      userSecretStrength,\n    } = this.state\n\n    return (\n      <div>\n        <TextField\n          autoComplete=\"new-password\"\n          fullWidth={true}\n          label=\"Password\"\n          margin=\"normal\"\n          type=\"password\"\n          value={userSecret}\n          variant=\"outlined\"\n          onChange={this._handle_onChange_Secret}\n        />\n\n        <TextField\n          autoComplete=\"new-password\"\n          fullWidth={true}\n          label=\"Confirm password\"\n          margin=\"normal\"\n          type=\"password\"\n          value={userSecretConfirm}\n          variant=\"outlined\"\n          onChange={this._handle_onChange_SecretConfirm}\n        />\n\n        <Typography variant=\"subtitle1\" gutterBottom>\n          <br />\n          {userSecretPrompt}\n        </Typography>\n\n        <LinearProgress\n          classes={{\n            colorPrimary: classes.strengthColorPrimary,\n            barColorPrimary:\n              classes['strengthBarColorPrimary_' + userSecretQuality],\n          }}\n          value={50 * userSecretStrength / userSecretStrengthGood}\n          variant=\"determinate\"\n        />\n      </div>\n    )\n  }\n}\n\nexport default withStyles(styles)(NewUserSecretInput)\n"],"file":"NewUserSecretInput.js"}
{"version":3,"sources":["../../../../units/urb-persister-cassandra/graphql/PersisterCassandra.js"],"names":["Uuid","CassandraDriver","types","Uuid_Null_String","Uuid_Null","fromString","ExpressCassandraClient","ExpressCassandra","createClient","clientOptions","CassandraOptions","ormOptions","defaultReplicationStrategy","class","replication_factor","migration","disableTTYConfirmation","createKeyspace","PersisterCassandra","constructor","tableSchemas","Map","getOneObject","entityName","ObjectType","filters","resultPromises","filter","options","raw","allow_filtering","hasOwnProperty","materialized_view","_materialized_view","Object","assign","push","Promise","resolve","reject","updateUuidsInFields","instance","findOne","err","entity","JSON","stringify","message","stack","all","getObjectList","find","arrEntities","arrRetObj","fields","schemaFields","_properties","schema","fieldName","fieldValue","$in","fieldType","add","save","update","remove","delete","createLogger","WinstonTransportCassandra","uuidFromString","str","uuidRandom","random","uuidNull","uuidNullAsString","uuidToString","id","toString","uuidEquals","id1","id2","equals","addTableSchema","tableName","tableSchema","set","console","error","process","exit","confirmHealth","modelInstance","User","get_cql_client","client","execute","result","initialize","runAsPartOfSetupDatabase","cb","enrolledTables","arrSchemas","keys","get","loadOneTableSchemaFromArray","length","splice","log","loadSchema","syncDB","name"],"mappings":"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","sourcesContent":["// @flow\n\nimport CassandraDriver from 'cassandra-driver'\nimport ExpressCassandra from 'express-cassandra'\n\nimport CassandraOptions from './CassandraOptions'\nimport WinstonTransportCassandra from './WinstonTransportCassandra'\n\nconst Uuid = CassandraDriver.types.Uuid\nconst Uuid_Null_String = '00000000-0000-0000-0000-000000000000'\nconst Uuid_Null = Uuid.fromString( Uuid_Null_String )\n\nconst ExpressCassandraClient = ExpressCassandra.createClient({\n  clientOptions: CassandraOptions, // Options are pre-set in a separate part of the application, they are correct\n  ormOptions: {\n    defaultReplicationStrategy: {\n      class: 'SimpleStrategy',\n      replication_factor: 1,\n    },\n    migration: 'alter',\n    disableTTYConfirmation: true,\n    createKeyspace: true,\n  },\n})\n\nexport default class PersisterCassandra {\n  tableSchemas: ?Map<string, Object>\n\n  constructor() {\n    this.tableSchemas = new Map()\n  }\n\n  getOneObject( entityName: string, ObjectType: any, filters: Array<any> ): Promise<any> {\n    const resultPromises = []\n\n    for ( let filter of filters ) {\n      // Configure our default options\n      let options: Object = {\n        raw: true,\n        allow_filtering: true,\n      }\n\n      // In order to use materialized view, we need to pass it to the opions\n      if ( filter.hasOwnProperty( '_materialized_view' ) ) {\n        // Set option to use materialized view\n        options.materialized_view = filter._materialized_view\n\n        // Remove _materialized_view from filter\n        filter = Object.assign({}, filter )\n        delete filter._materialized_view\n      }\n\n      resultPromises.push(\n        new Promise( ( resolve, reject ) => {\n          try {\n            this.updateUuidsInFields( entityName, filter )\n\n            ExpressCassandraClient.instance[entityName].findOne( filter, options, ( err, entity ) => {\n              if ( err )\n                reject(\n                  'getOneObject findOne failed: ' +\n                    JSON.stringify({ entityName, filters, message: err.message }),\n                )\n              else {\n                if ( entity != null ) resolve( new ObjectType( entity ) )\n                else resolve( null )\n              }\n            })\n          } catch ( err ) {\n            reject(\n              'getOneObject failed: ' +\n                JSON.stringify({ entityName, filters, message: err.message, stack: err.stack }),\n            )\n          }\n        }),\n      )\n    }\n\n    return Promise.all( resultPromises )\n  }\n\n  getObjectList( entityName: string, ObjectType: any, filters: Array<any> ): Promise<Array<any>> {\n    const resultPromises = []\n\n    for ( let filter of filters ) {\n      // Configure our default options\n      let options: Object = {\n        raw: true,\n        allow_filtering: true,\n      }\n\n      // In order to use materialized view, we need to pass it to the opions\n      if ( filter.hasOwnProperty( '_materialized_view' ) ) {\n        // Set option to use materialized view\n        options.materialized_view = filter._materialized_view\n\n        // Remove _materialized_view from filter\n        filter = Object.assign({}, filter )\n        delete filter._materialized_view\n      }\n\n      resultPromises.push(\n        new Promise( ( resolve, reject ) => {\n          try {\n            this.updateUuidsInFields( entityName, filter )\n\n            ExpressCassandraClient.instance[entityName].find(\n              filter,\n              options,\n              ( err, arrEntities ) => {\n                if ( err )\n                  reject(\n                    'getObjectList find failed: ' +\n                      JSON.stringify({ entityName, filters, message: err.message }),\n                  )\n                else {\n                  const arrRetObj = []\n                  for ( let entity of arrEntities ) arrRetObj.push( new ObjectType( entity ) )\n                  resolve( arrRetObj )\n                }\n              },\n            )\n          } catch ( err ) {\n            reject(\n              'getObjectList failed: ' +\n                JSON.stringify({ entityName, filters, message: err.message, stack: err.stack }),\n            )\n          }\n        }),\n      )\n    }\n\n    return Promise.all( resultPromises )\n  }\n\n  updateUuidsInFields( entityName: string, fields: any ) {\n    const schemaFields = ExpressCassandraClient.instance[entityName]._properties.schema.fields\n\n    for ( let fieldName in fields ) {\n      const fieldValue = fields[fieldName]\n\n      // $in should only be used with UUID, no strings will be allowed\n      if ( fieldValue.$in ) continue\n\n      const fieldType = schemaFields[fieldName]\n\n      if ( fieldType === 'uuid' ) {\n        if ( !( fieldValue instanceof Uuid ) ) {\n          fields[fieldName] = Uuid.fromString( fieldValue )\n        }\n      }\n    }\n  }\n\n  add( entityName: string, fields: any ): Promise<any> {\n    this.updateUuidsInFields( entityName, fields )\n\n    return new Promise( ( resolve, reject ) => {\n      const entity = new ExpressCassandraClient.instance[entityName]( fields )\n      entity.save( err => {\n        if ( err ) reject( err )\n        else resolve()\n      })\n    })\n  }\n\n  update( entityName: string, fields: any ): Promise<null> {\n    // TODO x2000 Optimize this with update, possibly. Maybe it's not so bad to read first after all\n    return this.add( entityName, fields )\n  }\n\n  remove( entityName: string, fields: any ): Promise<any> {\n    this.updateUuidsInFields( entityName, fields )\n\n    return new Promise( ( resolve, reject ) => {\n      ExpressCassandraClient.instance[entityName].delete( fields, err => {\n        if ( err ) reject( err )\n        else resolve()\n      })\n    })\n  }\n\n  createLogger() {\n    return new WinstonTransportCassandra( CassandraOptions )\n  }\n\n  uuidFromString( str: string ) {\n    return Uuid.fromString( str )\n  }\n\n  uuidRandom() {\n    return Uuid.random()\n  }\n\n  uuidNull() {\n    return Uuid_Null\n  }\n\n  uuidNullAsString() {\n    return Uuid_Null_String\n  }\n\n  uuidToString( id: any ): string {\n    if ( id instanceof Uuid ) id = id.toString()\n\n    return id\n  }\n\n  uuidEquals( id1: any, id2: any ): boolean {\n    return id1.equals( id2 )\n  }\n\n  addTableSchema( tableName: string, tableSchema: Object ): void {\n    if ( this.tableSchemas ) this.tableSchemas.set( tableName, tableSchema )\n    else {\n      console.error(\n        'Error: Attempting to add table schemas after express-cassandra client connect.',\n      )\n      process.exit( 1 )\n    }\n  }\n\n  confirmHealth(): Promise<any> {\n    return new Promise( ( resolve, reject ) => {\n      ExpressCassandraClient.modelInstance.User.get_cql_client( ( err, client ) => {\n        if ( err ) reject( err )\n        else\n          client.execute( 'select release_version from system.local;', ( err, result ) => {\n            if ( err ) reject( err )\n            else resolve()\n          })\n      })\n    })\n  }\n\n  initialize( runAsPartOfSetupDatabase: boolean, cb: Function ): void {\n    // All table schemas should have been added by now.\n    const enrolledTables = this.tableSchemas\n    this.tableSchemas = null // Free up the memory that is not needed any more and indicate that we can not add any more\n\n    const arrSchemas = []\n    // $AssureFlow enrolledTables should be populated here\n    for ( let tableName of enrolledTables.keys() ) {\n      // $AssureFlow enrolledTables should be populated here\n      arrSchemas.push([ tableName, enrolledTables.get( tableName ) ])\n    }\n    this.loadOneTableSchemaFromArray( arrSchemas, runAsPartOfSetupDatabase, cb )\n  }\n\n  loadOneTableSchemaFromArray(\n    arrSchemas: Array<any>,\n    runAsPartOfSetupDatabase: boolean,\n    cb: Function,\n  ): void {\n    if ( arrSchemas.length > 0 ) {\n      const tableName = arrSchemas[0][0]\n      const tableSchema = arrSchemas[0][1]\n      arrSchemas.splice( 0, 1 )\n\n      if ( runAsPartOfSetupDatabase ) {\n        console.log( ' Prepare table ' + tableName + '.' )\n      }\n      ExpressCassandraClient.loadSchema( tableName, tableSchema ).syncDB( err => {\n        if ( err ) {\n          console.log(\n            'Error:  Initializing Cassandra persister - error while creating ' + tableName + '!',\n          )\n          console.error( err.message )\n          process.exit( 1 )\n        } else {\n          if ( runAsPartOfSetupDatabase )\n            console.log(\n              ' Table ' +\n                ExpressCassandraClient.modelInstance[tableName]._properties.name +\n                ' ready.',\n            )\n          this.loadOneTableSchemaFromArray( arrSchemas, runAsPartOfSetupDatabase, cb )\n          // Load the next table\n          return\n        }\n      })\n    } else {\n      cb()\n    }\n  }\n}\n"],"file":"PersisterCassandra.js"}
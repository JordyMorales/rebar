{"version":3,"sources":["../../../units/urb-base-server/build-relay-schema.js"],"names":["reRemoveComments","RegExp","main","result","errors","Error","JSON","stringify","printedSchema","replace","taskPromises","resolve","Promise","all","then","console","log"],"mappings":";;AAEA,4B;;AAEA;AACA;;AAEA,2D;AACA,wE;;AAEA;AACA;AACA,MAAMA,mBAAmB,IAAIC,MAAJ,CAAY,aAAZ,EAA2B,GAA3B,CAAzB;;AAEA,eAAeC,IAAf,GAAsB;AACpB,QAAMC,SAAS,MAAM,sEAArB;AACA,MAAKA,OAAOC,MAAZ;AACE,QAAM,IAAIC,KAAJ,CAAW,kCAAkCC,KAAKC,SAAL,CAAgBJ,OAAOC,MAAvB,EAA+B,IAA/B,EAAqC,CAArC,CAA7C,CAAN;;AAEF,QAAMI,gBAAgB,8CAAsBC,OAAtB,CAA+BT,gBAA/B,EAAiD,GAAjD,CAAtB;;AAEA,QAAMU,eAAe;AACnB;AACE,iBAAKC,OAAL,CAAc,4DAAd,CADF;AAEE,MAFF;AAGEL,OAAKC,SAAL,CAAgBJ,MAAhB,EAAwB,IAAxB,EAA8B,CAA9B,CAHF,CADmB;;AAMnB,mCAAmB,eAAKQ,OAAL,CAAc,gBAAd,CAAnB,EAAqD,IAArD,EAA2DH,aAA3D,CANmB,CAArB;;;AASA,QAAMI,QAAQC,GAAR,CAAaH,YAAb,CAAN;AACD;;AAEDR,OAAOY,IAAP,CAAa,MAAMC,QAAQC,GAAR,CAAa,MAAb,CAAnB","file":"build-relay-schema.js","sourcesContent":["// @flow\n\nimport path from 'path'\n\nimport { graphql } from 'graphql'\nimport { introspectionQuery, printSchema } from 'graphql/utilities'\n\nimport schema from '../urb-base-server/graphql/schema'\nimport ensureFileContent from '../urb-base-tools/ensureFileContent'\n\n// TODO x0500 It is a complete mystery to me why the comments are encased in \"\"\" but the relay\n// compiler does not like them. Either way, this sanitizes the schema and removes the comment.\nconst reRemoveComments = new RegExp( '\"\"\"[^\"]*\"\"\"', 'g' )\n\nasync function main() {\n  const result = await graphql( schema, introspectionQuery )\n  if ( result.errors )\n    throw new Error( 'Failed introspecting schema: ' + JSON.stringify( result.errors, null, 2 ) )\n\n  const printedSchema = printSchema( schema ).replace( reRemoveComments, '#' )\n\n  const taskPromises = [\n    ensureFileContent(\n      path.resolve( './units/_configuration/urb-base-server/graphql/schema.json' ),\n      null,\n      JSON.stringify( result, null, 2 ),\n    ),\n    ensureFileContent( path.resolve( 'schema.graphql' ), null, printedSchema ),\n  ]\n\n  await Promise.all( taskPromises )\n}\n\nmain().then( () => console.log( 'Fin.' ) )\n"]}
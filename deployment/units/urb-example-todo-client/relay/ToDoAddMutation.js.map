{"version":3,"sources":["../../../../units/urb-example-todo-client/relay/ToDoAddMutation.js"],"names":["mutation","sharedUpdater","store","user","ToDosEdge","userProxy","get","id","forEach","status","connection","ConnectionHandler","getConnection","insertEdgeAfter","nextClientMutationId","commit","environment","ToDo_Text","clientMutationId","variables","input","updater","payload","getRootField","getLinkedRecord","optimisticUpdater","aToDo","create","setValue","setLinkedRecord","ToDo_TotalCount","getValue"],"mappings":";;AAEA;AACA,6C,CAHA;;AAKA,MAAMA,QAAQ,2EAAd;;;;;;;;;;;;;;;;;;;AAmBA,SAASC,aAAT,CAAwBC,KAAxB,EAA+BC,IAA/B,EAAqCC,SAArC,EAAiD;AAC/C,QAAMC,SAAS,GAAGH,KAAK,CAACI,GAAN,CAAWH,IAAI,CAACI,EAAhB,CAAlB;AACC,GAAE,KAAF,EAAS,QAAT,EAAoBC,OAApB,CAA6BC,MAAM,IAAI;AACtC,UAAMC,UAAU,GAAGC,gCAAkBC,aAAlB,CAAiCP,SAAjC,EAA4C,gBAA5C,EAA8D,EAAEI,MAAF,EAA9D,CAAnB;AACA,QAAKC,UAAL,EAAkB;AAChBC,sCAAkBE,eAAlB,CAAmCH,UAAnC,EAA+CN,SAA/C;AACD;AACF,GALA;AAMF;;AAED,IAAIU,oBAAoB,GAAG,CAA3B;;AAEA,SAASC,MAAT,CAAiBC,WAAjB,EAA8Bb,IAA9B,EAAoCc,SAApC,EAAgD;AAC9C,QAAMC,gBAAgB,GAAGJ,oBAAoB,EAA7C;;AAEA,SAAO,gCAAgBE,WAAhB,EAA6B;AAClChB,IAAAA,QADkC;AAElCmB,IAAAA,SAAS,EAAE;AACTC,MAAAA,KAAK,EAAE,EAAEH,SAAF,EAAaC,gBAAb,EADE,EAFuB;;;AAMlCG,IAAAA,OAAO,CAAEnB,KAAF,EAAU;AACf,YAAMoB,OAAO,GAAGpB,KAAK,CAACqB,YAAN,CAAoB,SAApB,CAAhB;AACAtB,MAAAA,aAAa,CAAEC,KAAF,EAASC,IAAT,EAAemB,OAAO,CAACE,eAAR,CAAyB,WAAzB,CAAf,CAAb;AACD,KATiC;;AAWlCC,IAAAA,iBAAiB,CAAEvB,KAAF,EAAU;AACzB,YAAMK,EAAE,GAAI,uBAAsBW,gBAAiB,EAAnD;AACA,YAAMQ,KAAK,GAAGxB,KAAK,CAACyB,MAAN,CAAcpB,EAAd,EAAkB,MAAlB,CAAd;AACAmB,MAAAA,KAAK,CAACE,QAAN,CAAgBX,SAAhB,EAA2B,WAA3B;AACAS,MAAAA,KAAK,CAACE,QAAN,CAAgBrB,EAAhB,EAAoB,IAApB;;AAEA,YAAMH,SAAS,GAAGF,KAAK,CAACyB,MAAN,CAAe,4BAA2BT,gBAAiB,EAA3D,EAA8D,WAA9D,CAAlB;AACAd,MAAAA,SAAS,CAACyB,eAAV,CAA2BH,KAA3B,EAAkC,MAAlC;;AAEAzB,MAAAA,aAAa,CAAEC,KAAF,EAASC,IAAT,EAAeC,SAAf,CAAb;;AAEA,YAAMC,SAAS,GAAGH,KAAK,CAACI,GAAN,CAAWH,IAAI,CAACI,EAAhB,CAAlB;AACA,YAAMuB,eAAe,GAAGzB,SAAS,CAAC0B,QAAV,CAAoB,iBAApB,CAAxB;AACA,UAAKD,eAAe,IAAI,IAAxB,EAA+B;AAC7BzB,QAAAA,SAAS,CAACuB,QAAV,CAAoBE,eAAe,GAAG,CAAtC,EAAyC,iBAAzC;AACD;AACF,KA3BiC,EAA7B,CAAP;;AA6BD,C;;AAEc,EAAEf,MAAF,E","sourcesContent":["// @flow weak\n\nimport { commitMutation, graphql } from 'react-relay'\nimport { ConnectionHandler } from 'relay-runtime'\n\nconst mutation = graphql`\n  mutation ToDoAddMutation($input: ToDoAddInput!) {\n    ToDoAdd(input: $input) {\n      Viewer {\n        id\n        ToDo_TotalCount\n      }\n      ToDosEdge {\n        cursor\n        node {\n          id\n          ToDo_Complete\n          ToDo_Text\n        }\n      }\n    }\n  }\n`\n\nfunction sharedUpdater( store, user, ToDosEdge ) {\n  const userProxy = store.get( user.id )\n  ;[ 'any', 'active' ].forEach( status => {\n    const connection = ConnectionHandler.getConnection( userProxy, 'ToDoList_ToDos', { status })\n    if ( connection ) {\n      ConnectionHandler.insertEdgeAfter( connection, ToDosEdge )\n    }\n  })\n}\n\nlet nextClientMutationId = 0\n\nfunction commit( environment, user, ToDo_Text ) {\n  const clientMutationId = nextClientMutationId++\n\n  return commitMutation( environment, {\n    mutation,\n    variables: {\n      input: { ToDo_Text, clientMutationId },\n    },\n\n    updater( store ) {\n      const payload = store.getRootField( 'ToDoAdd' )\n      sharedUpdater( store, user, payload.getLinkedRecord( 'ToDosEdge' ) )\n    },\n\n    optimisticUpdater( store ) {\n      const id = `client:ToDoAdd:ToDo:${clientMutationId}`\n      const aToDo = store.create( id, 'ToDo' )\n      aToDo.setValue( ToDo_Text, 'ToDo_Text' )\n      aToDo.setValue( id, 'id' )\n\n      const ToDosEdge = store.create( `client:ToDoAdd:ToDosEdge:${clientMutationId}`, 'ToDosEdge' )\n      ToDosEdge.setLinkedRecord( aToDo, 'node' )\n\n      sharedUpdater( store, user, ToDosEdge )\n\n      const userProxy = store.get( user.id )\n      const ToDo_TotalCount = userProxy.getValue( 'ToDo_TotalCount' )\n      if ( ToDo_TotalCount != null ) {\n        userProxy.setValue( ToDo_TotalCount + 1, 'ToDo_TotalCount' )\n      }\n    },\n  })\n}\n\nexport default { commit }\n"],"file":"ToDoAddMutation.js"}
{"version":3,"sources":["../../../../units/urb-example-todo-client/relay/ToDoUpdateStatusMutation.js"],"names":["mutation","sharedUpdater","store","user","proxyToDo","userProxy","get","id","status","getValue","connection","ConnectionHandler","getConnection","deleteNode","commit","environment","aToDo","ToDo_Complete","variables","input","updater","payload","getRootField","getLinkedRecord","optimisticUpdater","setValue","ToDo_CompletedCount"],"mappings":";;AAEA;AACA,6C,CAHA;;AAKA,MAAMA,4FAAN;;;;;;;;;;;;;;;AAeA,SAASC,aAAT,CAAwBC,KAAxB,EAA+BC,IAA/B,EAAqCC,SAArC,EAAiD;AAC/C;AACA;AACA,QAAMC,YAAYH,MAAMI,GAAN,CAAWH,KAAKI,EAAhB,CAAlB;AACA,QAAMC,SAASJ,UAAUK,QAAV,CAAoB,eAApB,IAAwC,QAAxC,GAAmD,WAAlE;AACA,QAAMC,aAAaC,gCAAkBC,aAAlB,CAAiCP,SAAjC,EAA4C,gBAA5C,EAA8D,EAAEG,MAAF,EAA9D,CAAnB;AACA,MAAKE,UAAL,EAAkB;AAChBC,oCAAkBE,UAAlB,CAA8BH,UAA9B,EAA0CN,UAAUK,QAAV,CAAoB,IAApB,CAA1C;AACD;AACF;;AAED,SAASK,MAAT,CAAiBC,WAAjB,EAA8BZ,IAA9B,EAAoCa,KAApC,EAA2CC,aAA3C,EAA2D;AACzD,SAAO,gCAAgBF,WAAhB,EAA6B;AAClCf,YADkC;AAElCkB,eAAW;AACTC,aAAO,EAAEZ,IAAIS,MAAMT,EAAZ,EAAgBU,aAAhB,EADE,EAFuB;;;AAMlCG,YAASlB,KAAT,EAAiB;AACf,YAAMmB,UAAUnB,MAAMoB,YAAN,CAAoB,kBAApB,CAAhB;AACArB,oBAAeC,KAAf,EAAsBC,IAAtB,EAA4BkB,QAAQE,eAAR,CAAyB,MAAzB,CAA5B;AACD,KATiC;;AAWlCC,sBAAmBtB,KAAnB,EAA2B;AACzB,YAAME,YAAYF,MAAMI,GAAN,CAAWU,MAAMT,EAAjB,CAAlB;AACAH,gBAAUqB,QAAV,CAAoBR,aAApB,EAAmC,UAAnC;AACAhB,oBAAeC,KAAf,EAAsBC,IAAtB,EAA4BC,SAA5B;;AAEA,YAAMC,YAAYH,MAAMI,GAAN,CAAWH,KAAKI,EAAhB,CAAlB;AACA,YAAMmB,sBAAsBrB,UAAUI,QAAV,CAAoB,qBAApB,CAA5B;AACA,UAAKiB,uBAAuB,IAA5B,EAAmC;AACjCrB,kBAAUoB,QAAV,CAAoBC,uBAAwBT,gBAAgB,CAAhB,GAAoB,CAAC,CAA7C,CAApB,EAAsE,qBAAtE;AACD;AACF,KArBiC,EAA7B,CAAP;;AAuBD,C;;AAEc,EAAEH,MAAF,E","file":"ToDoUpdateStatusMutation.js","sourcesContent":["// @flow weak\n\nimport { commitMutation, graphql } from 'react-relay'\nimport { ConnectionHandler } from 'relay-runtime'\n\nconst mutation = graphql`\n  mutation ToDoUpdateStatusMutation($input: ToDoUpdateStatusInput!) {\n    ToDoUpdateStatus(input: $input) {\n      Viewer {\n        id\n        ToDo_CompletedCount\n      }\n      ToDo {\n        id\n        ToDo_Complete\n      }\n    }\n  }\n`\n\nfunction sharedUpdater( store, user, proxyToDo ) {\n  // In principle this could add to the active connection, but such an\n  // interaction is not possible from the front end.\n  const userProxy = store.get( user.id )\n  const status = proxyToDo.getValue( 'ToDo_Complete' ) ? 'active' : 'completed'\n  const connection = ConnectionHandler.getConnection( userProxy, 'ToDoList_ToDos', { status })\n  if ( connection ) {\n    ConnectionHandler.deleteNode( connection, proxyToDo.getValue( 'id' ) )\n  }\n}\n\nfunction commit( environment, user, aToDo, ToDo_Complete ) {\n  return commitMutation( environment, {\n    mutation,\n    variables: {\n      input: { id: aToDo.id, ToDo_Complete },\n    },\n\n    updater( store ) {\n      const payload = store.getRootField( 'ToDoUpdateStatus' )\n      sharedUpdater( store, user, payload.getLinkedRecord( 'ToDo' ) )\n    },\n\n    optimisticUpdater( store ) {\n      const proxyToDo = store.get( aToDo.id )\n      proxyToDo.setValue( ToDo_Complete, 'complete' )\n      sharedUpdater( store, user, proxyToDo )\n\n      const userProxy = store.get( user.id )\n      const ToDo_CompletedCount = userProxy.getValue( 'ToDo_CompletedCount' )\n      if ( ToDo_CompletedCount != null ) {\n        userProxy.setValue( ToDo_CompletedCount + ( ToDo_Complete ? 1 : -1 ), 'ToDo_CompletedCount' )\n      }\n    },\n  })\n}\n\nexport default { commit }\n"]}